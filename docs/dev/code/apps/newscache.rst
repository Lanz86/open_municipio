=========
Newscache
=========

.. contents::


Introduction
============

This application is responsible of populating the **news-cache**.

The news-cache keeps a log of all **important** events of OpenMunicipio, as they happen.

Events are generated by activities going on within the web application. Both institutional and community activities are tracked.

Institutional activities are generated by moderators describing, tagging or validating acts, 
or by automatic imports of sittings-related activity (votations, interventions, ...).

Community activities are generated by logged-in users commenting and voting content objects (like acts) and by politicians, 
when, as logged-in users, they describe an act.

This cache is needed to speed up the generation of textual news related to these events, and to allow the 
application to generate rapidly and without too many queries and computations, the correct set of news for a given **context**.

**Contexts** may be a page in the application or the alert mail that the system sends to those users that activated the monitoring functionality.



Implementation details
======================
The cache takes the form of a table, where both the textual representation of the news item and the parameters needed to fetch the correct set of news are stored.

Records are generated in response to `signals`_ sent by the application.

Being a cache, it should be possible to erase it and regenerate it completely, starting from data already in the database.

For this reason, signal handlers should call record-generating functions, so that these same functions could be invoked by
management commands, whenever they are issued in order to re-generate the cache.

One event - Many news
=====================
An example: whenever an act is signed by some politician, a different set of news, with different point of views (or scope), will be generated:

* a news item related to that act, with low priority (3)
* a news item related to that politician, with higher priority (2)
* two news items related to the tag(s) and location(s) the act is tagged with, with low priority (3)


The scope identifies the content object the news is related to. 
Having different news items for different scopes has many advantages. e.g.:

* it's possible, while visualizing a politician page, to get all the news items related to that politician
* the textual representation of a news item may be context-sensitive

In order to abstract the newscache application as much as possible from the project's details, this is going to be implemented through generic relations, 
so a news has a generic relation to the content object it is related to.


.. _`signals`: https://docs.djangoproject.com/en/dev/topics/signals/ 

{% extends 'base_two_columns.html' %}
{% load highlight %}
{% load om_utils %}
{% load i18n %}
{% load digg_paginator %}

{% block title %}Elenco atti {% endblock title %}
{% block content_header %}Atti{% endblock %}
{% block acts_class %}active{% endblock %}

{% block extra_style %}
em {
    background-color: yellow;
}
{% endblock %}

{% block content %}

    {% if n_results %}

      <section>
          <h3>{% if not query %}Trovati {% endif %} {{ n_results }} documenti</h3>

          {% if person %}
              <p>per il politico: <a href="{{ person.get_absolute_url }}">{{ person }}</a>  </p>
          {% endif %}

          {% if category %}
              <p>per la categoria: <a href="{{ category.get_absolute_url }}">{{ category }}</a>  </p>
          {% endif %}

          {% if tag %}
              <p>per l'argomento: <a href="{{ tag.get_absolute_url }}">{{ tag }}</a>  </p>
          {% endif %}

          {% if location %}
              <p>per la localit√†: <a href="{{ location.get_absolute_url }}">{{ location }}</a>  </p>
          {% endif %}

          <table class="search-results">
          <tbody>
          {% for result in page.object_list %}
          <tr>
            <td>{{ result.pub_date|circled:"full" }}</td>
            <td>
              <h4><a href="{{ result.url }}">{{ result.title }}</a></h4>
              <strong>{{ result.act_type }}</strong>
              {% if result.highlighted.text %}
                {{ result.highlighted.text.0|safe }}<br/>
              {% endif %}
              {% if result.categories %}
                <br/>Categorie: {% for cat in result.categories %}<a href="{{ cat.get_absolute_url }}">{{ cat }}</a>{% if not forloop.last %}, {% endif %}{% endfor %}
              {% endif %}
              {% if result.tags %}
                <br/>Tag: {% for tag in result.tags %}<a href="{{ tag.get_absolute_url }}">{{ tag }}</a>{% if not forloop.last %}, {% endif %}{% endfor %}
              {% endif %}
              <!-- <strong>Score:</strong> {{ result.score }} -->
            </td>
          </tr>
          {% empty %}
              <p>Nessun risultato trovato.</p>
          {% endfor %}
          </tbody>
        </table>
      </section>

      {% digg_paginator %}

    {% else %}
        {# Show some example queries to run, maybe query syntax, something else? #}
    {% endif %}

{% endblock %}

{% block sidebar %}

  <h4>Cerca negli atti</h4>
  <form method="get" action="{% url om_act_search %}" class="form-search">
      <div class="control-group input-append">
          {%  spaceless %}
              <input id="query" type="text" class="input-medium search-query" name="{{ form.q.html_name }}"
                     value="{% if form.q.value %}{{ form.q.value }}{% endif %}" placeholder="Testo della ricerca" />
              <span id="clear-query" class="btn add-on"><i class="icon-remove"></i></span>
          {%  endspaceless %}
      </div><br/>
      <input id="person-id" name="{{ form.person.html_name }}"
             value="{% if form.person.value %}{{ form.person.value }}{% endif %}" type="hidden"/>
      <button type="submit" class="btn">Cerca</button>
  </form>

    {% if n_results %}

        {% if selected_facets %}
            <h3>Modifica i filtri</h3>
            {% for facet in selected_facets  %}
                <dt>{{ facets_labels|key:facet.field|safe }}</dt>
                <dd>
                    <a href="{{ facet.url }}"><i class="icon-remove"></i></a>
                    {{ facet.r_label }}
                </dd>
            {% endfor %}
        {% else %}
            <h3>Filtra</h3>
            <p>Puoi trovare l'atto che ti interessa scorrendo la lista degli ultimi pubblicati, qui a fianco.
                Puoi perfezionare la ricerca usando i filtri nella colonna qui sotto, oppure puoi usare il form di
                ricerca con una parola che pensi sia contenuta nell'atto ,
                in cima alla colonna qui a destra</p>
        {% endif %}

        <!-- Begin faceting. -->

        <div>
            <dl>
                {% if facets.fields.act_type and not facets.fields.act_type.is_field_selected %}
                    <dt>{{ facets_labels.act_type }}</dt>
                    {# Provide all act types #}
                    {% for t in facets.fields.act_type.counts %}
                        {% if t.1 %}
                            <dd>
                                {% if not t.2 %}
                                    <a href="{{ base_url }}&selected_facets=act_type:{{ t.0|urlencode }}">{{ t.0 }}</a> ({{ t.1 }})
                                {% endif %}
                            </dd>
                        {% endif %}
                    {% endfor %}
                {% endif %}
            </dl>
            <dl>
                {% if facets.fields.is_key and not facets.fields.is_key.is_field_selected %}
                    <dt>{{ facets_labels.is_key }}</dt>
                    {# Provide both cases (true, false) #}
                    {% for t in facets.fields.is_key.counts %}
                        {% if t.1 %}
                        <dd>
                            {% if not t.2 %}
                                <a href="{{ base_url }}&selected_facets=is_key:{{ t.0|urlencode }}">{{ t.0 }}</a> ({{ t.1 }})
                            {% endif %}
                        </dd>
                        {%  endif %}
                    {% endfor %}
                {% endif %}
            </dl>
            {% if show_is_proposal_facets %}
            <dl>
                {% if facets.fields.is_proposal and not facets.fields.is_proposal.is_field_selected %}
                    <dt>{{ facets_labels.is_proposal }}</dt>
                    {# Provide both cases (true, false) #}
                    {% for t in facets.fields.is_proposal.counts %}
                        {% if t.1 %}
                            <dd>
                                {% if not t.2 %}
                                    <a href="{{ base_url }}&selected_facets=is_proposal:{{ t.0|urlencode }}">{{ t.0 }}</a> ({{ t.1 }})
                                {% endif %}
                            </dd>
                        {%  endif %}
                    {% endfor %}
                {% endif %}
            </dl>
            {% endif %}
            {% if show_initiative_facets %}
            <dl>
                {% if facets.fields.initiative and not facets.fields.initiative.is_field_selected  %}
                    <dt>{{ facets_labels.initiative }}</dt>
                    {% for t in facets.fields.initiative.counts %}
                        <dd>
                            {% if not t.2 %}
                                <a href="{{ base_url }}&selected_facets=initiative:{{ t.0|urlencode }}">{{ t.0 }}</a> ({{ t.1 }})
                            {% endif %}
                        </dd>
                    {% endfor %}
                {% endif %}
            </dl>
            {% endif %}
            <dl>
                {% if facets.fields.organ and not facets.fields.organ.is_field_selected %}
                    <dt>{{ facets_labels.organ }}</dt>
                    {# Provide both cases (true, false) #}
                    {% for t in facets.fields.organ.counts %}
                        {% if t.1 %}
                            <dd>
                                {% if not t.2 %}
                                    <a href="{{ base_url }}&selected_facets=organ:{{ t.0|urlencode }}">{{ t.0 }}</a> ({{ t.1 }})
                                {% endif %}
                            </dd>
                        {%  endif %}
                    {% endfor %}
                {% endif %}
            </dl>

            <dl>
                {% if not facet_queries_date.is_selected %}
                    <dt>{{ facets_labels.pub_date }}</dt>
                    {% for range in facet_queries_date.ranges|dictsortreversed:"key"  %}
                        <dd>
                            <a href="{{ base_url }}&selected_facets={{ range.key }}">
                                {{ range.label|safe }}
                            </a> ({{ range.count }})
                        </dd>
                    {% endfor %}
                {% endif %}
            </dl>
        </div>
        <!-- End faceting -->

    {% endif %}


{% endblock %}
{% extends "base_two_columns.html" %}
{% load i18n %}
{% load om_utils %}
{% load bookmarking_tags %}

{% block title %}| Dettaglio {{ votation }}{% endblock %}

{% block content_header %}Votazione{% endblock %}

{% block votations_class %}active{% endblock %}


{% block head_css_includes %}
    {{ block.super }}
    <link rel="stylesheet" href="{{ STATIC_URL }}css/bookmarking.css" />
    <style type="text/css">
      #content table#votation_outcome i {
        font-size: 30px; line-height: 30px;
      }
    </style>
{% endblock head_css_includes %}

{% block footer_js_includes %}
    {{ block.super }}
    <script type="text/javascript" src="{{ STATIC_URL }}js/ajax_csrf.js" charset="utf-8"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/bootstrap-tab.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/jquery.tablesorter.min.js"></script>
    {% if user.is_staff %}
        <script src="{{ STATIC_URL }}js/bookmarking.js" type="text/javascript" charset="utf-8"></script>
    {% endif %}
  <script type="text/javascript">
    $(function(){
      $(".tablesorter").tablesorter({

        });
    });
  </script>
{% endblock footer_js_includes %}

{% block content %}

  <table class="pull-right bg-lighter" id="votation_outcome">
    <tr>
      {% if votation.outcome == votation.PASSED %}
      <td>{{ '<i class="icon-thumbs-up"></i>'|safe|circled:"voteok" }}</td>
      <td><p>Approvato</p></td>
      {% else %}
      <td>{{ '<i class="icon-thumbs-down"></i>'|safe|circled:"voteko" }}</td>
      <td><p>Respinto</p></td>
      {% endif %}
    </tr>
  </table>

  <hgroup>
    <h1 class="highlight">Votazione <strong>N.{{ votation.idnum }}</strong></h1>
    <h2>
      <i id="{{ votation|as_token }}" class="bookmarkable {% is_key_class votation %}"></i>{{ votation.act.title }}
    </h2>
    <h4>
      {% if votation.act %}
        Proposta di <strong>{{ votation.act_type }}</strong>
        del {{ votation.act.emitting_institution }} NÂ° <strong>{{ votation.act.idnum }}</strong>
        del <strong>{{ votation.act.presentation_date|date:"d F Y" }}</strong>
      {% else %}
        {{ votation.act_descr }}
      {% endif %}
    </h4>
  </hgroup>

  <table class="data text-right table-condensed tablesorter" id="votation_results">
    <thead>
      <tr>
        <th class="sorter-left text-left">Gruppi</th>
        <th>Favorevoli</th>
        <th>Contrari</th>
        <th>Astenuti</th>
        <th>Assenti</th>
        <th>In missione</th>
      </tr>
    </thead>
    <tbody>
      {% for group_vote in votation.group_votes %}
      <tr>
        <td class="text-left"><strong>{{ group_vote.group.name }}</strong> ({{ group_vote.group.acronym }})</td>
        <td>{{ group_vote.n_yes }}</td>
        <td>{{ group_vote.n_no }}</td>
        <td>{{ group_vote.n_abst }}</td>
        <td>{{ group_vote.n_absent }}</td>
        <td>{{ group_vote.n_mission }}</td>
      </tr>
      {% endfor %}
    </tbody>
    <tfoot>
      <tr>
        <td class="text-left">Totale</td>
        <td>{{ votation.n_yes }}</td>
        <td>{{ votation.n_no }}</td>
        <td>{{ votation.n_abst }}</td>
        <td>{{ votation.n_absent }}</td>
        <td>{{ votation.n_mission }}</td>
      </tr>
    </tfoot>
  </table>


  <section>
    <ul class="nav nav-tabs page-tabs">
      <li class="active">
        <a href="#all_votes_tab" data-toggle="tab">Tutti</a>
      </li>
      <li><a href="#rebels_votes_tab" data-toggle="tab">Ribelli</a></li>
    </ul>
    <div class="tab-content">
      <div class="tab-pane active" id="all_votes_tab">
        <table class="data text-right tablesorter">
          <thead>
          <tr>
            <th class="sorter-left text-left">Politico</th>
            <th>Favorevole</th>
            <th>Contrario</th>
            <th>Astenuto</th>
            <th>Assente</th>
            <th>In missione</th>
          </tr>
          </thead>
          <tbody>
          {% for charge_vote in votation.charge_votes %}
            {% with charge_vote.charge.person as politician %}
              <tr>
                <td class="text-left">
                  <a href="{{ politician.get_absolute_url }}">
                    <strong>{{ politician.full_name }}</strong> ({{ charge_vote.charge.council_group.acronym }})
                  </a>
                </td>
                <td>
                  {% if charge_vote.vote == charge_vote.VOTES.yes %}
                    <span class="label label-success">Favorevole</span>
                  {% endif %}
                </td>
                <td>
                  {% if charge_vote.vote == charge_vote.VOTES.no %}
                    <span class="label label-important">Contrario</span>
                  {% endif %}
                </td>
                <td>
                  {% if charge_vote.vote == charge_vote.VOTES.abstained %}
                    <span class="label">Astenuto</span>
                  {% endif %}
                </td>
                <td>
                  {% if charge_vote.vote == charge_vote.VOTES.absent %}
                    <span class="label label-text">Assente</span>
                  {% endif %}
                </td>
                <td>
                  {% if charge_vote.vote == charge_vote.VOTES.mission %}
                    <span class="label label-info">Missione</span>
                  {% endif %}
                </td>
              </tr>
            {% endwith %}
          {% endfor %}
          </tbody>
        </table>
      </div>

      <div class="tab-pane" id="rebels_votes_tab">

        <table class="data text-right tablesorter">
          <thead>
          <tr>
            <th class="sorter-left text-left">Politico</th>
            <th>Favorevole</th>
            <th>Contrario</th>
            <th>Astenuto</th>
            <th>Assente</th>
            <th>In missione</th>
          </tr>
          </thead>
          <tbody>
          {% for charge_vote in votation.charge_votes %}
            {% with charge_vote.charge.person as politician %}
              {% if charge_vote.is_rebel %}
              <tr>
                <td>
                  <a href="{{ politician.get_absolute_url }}">
                    <strong>{{ politician.full_name }}</strong> ({{ charge_vote.charge.council_group.acronym }})
                  </a>
                </td>
                <td>
                  {% if charge_vote.vote == charge_vote.VOTES.yes %}
                    <span class="label label-success">Favorevole</span>
                  {% endif %}
                </td>
                <td>
                  {% if charge_vote.vote == charge_vote.VOTES.no %}
                    <span class="label label-warning">Contrario</span>
                  {% endif %}
                </td>
                <td>
                  {% if charge_vote.vote == charge_vote.VOTES.abstained %}
                    <span class="label">Astenuto</span>
                  {% endif %}
                </td>
                <td>
                  {% if charge_vote.vote == charge_vote.VOTES.absent %}
                    <span class="label label-text">Assente</span>
                  {% endif %}
                </td>
              </tr>
              {% endif %}
            {% endwith %}
          {% endfor %}
          </tbody>
        </table>

      </div>
    </div>
  </section>
{% endblock content %}

{% block sidebar %}

  <table class="stats">
    <tr>
      <td>{{ votation.n_yes|circled:"voteok" }}</td>
      <th class="span6">Favorevoli</th>
      <td>{{ votation.n_no|circled:"voteko" }}</td>
      <th class="span6">Contrari</th>
    </tr>
    <tr>
      <td>{{ votation.n_abst|circled }}</td>
      <th class="span6">Astenuti</th>
      <td>{{ '-'|circled }}</td>
      <th class="span6">Voti di scarto</th>
    </tr>
    <tr>
      <td>{{ votation.n_rebels|circled }}</td>
      <th colspan="3">Politici ribelli</th>
    </tr>
  </table>

  <hr>

  <div class="tabbable">
    <ul class="nav nav-tabs">
      <li class="active"><a href="#chart-tab-yes" data-toggle="tab">Favorevoli</a></li>
      <li><a href="#chart-tab-no" data-toggle="tab">Contrari</a></li>
      <li><a href="#chart-tab-abst" data-toggle="tab">Astenuti</a></li>
      <li><a href="#chart-tab-rebels" data-toggle="tab">Ribelli</a></li>
    </ul>
    <div class="tab-content">
      <div class="tab-pane active" id="chart-tab-yes">
        <p><img src="https://chart.googleapis.com/chart?cht=p&chs=368x154&chl={% for group_vote in votation.group_votes %}{{ group_vote.group.acronym }} {{ group_vote.n_yes }}{% if not forloop.last %}|{% endif %}{% endfor %}&chd=t:{% for group_vote in votation.group_votes %}{{ group_vote.n_yes }}{% if not forloop.last %},{% endif %}{% endfor %}&chco=CC0000,FFFF33">
        </p>
      </div>
      <div class="tab-pane" id="chart-tab-no">
        <p><img src="https://chart.googleapis.com/chart?cht=p&chs=368x154&chl={% for group_vote in votation.group_votes %}{{ group_vote.group.acronym }} {{ group_vote.n_no }}{% if not forloop.last %}|{% endif %}{% endfor %}&chd=t:{% for group_vote in votation.group_votes %}{{ group_vote.n_no }}{% if not forloop.last %},{% endif %}{% endfor %}&chco=CC0000,FFFF33">
        </p>
      </div>
      <div class="tab-pane" id="chart-tab-abst">
        <p><img src="https://chart.googleapis.com/chart?cht=p&chs=368x154&chl={% for group_vote in votation.group_votes %}{{ group_vote.group.acronym }} {{ group_vote.n_abst }}{% if not forloop.last %}|{% endif %}{% endfor %}&chd=t:{% for group_vote in votation.group_votes %}{{ group_vote.n_abst }}{% if not forloop.last %},{% endif %}{% endfor %}&chco=CC0000,FFFF33">
        </p>
      </div>
      <div class="tab-pane" id="chart-tab-rebels">
        <p><img src="https://chart.googleapis.com/chart?cht=p&chs=368x154&chl={% for group_vote in votation.group_votes %}{{ group_vote.group.acronym }} {{ group_vote.n_rebels }}{% if not forloop.last %}|{% endif %}{% endfor %}&chd=t:{% for group_vote in votation.group_votes %}{{ group_vote.n_rebels }}{% if not forloop.last %},{% endif %}{% endfor %}&chco=CC0000,FFFF33">
        </p>
      </div>
    </div>
  </div>

  <hr>

  <section>
    <h3>Commenti (20)</h3>
    <ul class="comments-list">
      <li>
        <a href="#"><img src="{{ STATIC_URL }}img/placehold/50.gif" /></a>
        <div>
          <p>
            <a href="#">User</a>
            Lorem ipsum dolor sit amet,consectetuer adipiscing elit. Suspendisse ut purus.
          </p>
          <i class="hand-ok hand-active"></i> &middot; 05 Feb 2012  &middot; <a href="#">Mi piace</a> <i class="hand-like"></i> 10
        </div>
      </li>
      <li class="bg-highlight">
        <a href="#"><img src="{{ STATIC_URL }}img/placehold/50.gif" /></a>
        <div>
          <p>
            <a href="#">User</a>
            Lorem ipsum dolor sit amet,consectetuer adipiscing elit. Suspendisse ut purus.
          </p>
          <i class="hand-ok hand-active"></i> &middot; 06 Feb 2012  &middot; <a href="#">Mi piace</a> <i class="hand-like"></i> 10
        </div>
      </li>
      <li>
        <a href="#"><img src="{{ STATIC_URL }}img/placehold/50.gif" /></a>
        <div>
          <p>
            <a href="#">User</a>
            Lorem ipsum dolor sit amet,consectetuer adipiscing elit. Suspendisse ut purus.
          </p>
          <i class="hand-ok hand-active"></i> &middot; 07 Feb 2012  &middot; <a href="#">Non mi piace piÃ¹</a> <i class="hand-like"></i> 10
        </div>
      </li>
    </ul>

    {% if request.user.is_authenticated %}
      <form id="comment-form" action="#" method="post" class="form-inline box">
        <p>
          <textarea name="" class="input-expanded" data-plugin="autogrow" placeholder="Inserisci un commento" id="comment-form-text" rows="1"></textarea>
        </p>
        <button type="submit" class="btn btn-mini pull-right" id="comment-form-submit">{% trans 'Post' %} </button>
        <p>
          <label>Scegli la posizione</label>
        </p>
      </form>
    {% endif %}

    <p class="box">
      <a href="#">Leggi tutti</a> <i class="icon-play-down"></i>
    </p>
  </section>

  <hr>

  <section>
    <h3>Ultime sul Voto <img src="{{ STATIC_URL }}img/feed-icon-14x14.png" alt="" /></h3>

    <ul class="list-simple">
      <li>01.01.2012 - Mario Rossi ha commentato il voto</li>
      <li>01.01.2012 - Mario Rossi ha commentato il voto</li>
      <li>01.01.2012 - Mario Rossi ha commentato il voto</li>
    </ul>

    <p class="box">
      <a href="#">Leggi tutti</a> <i class="icon-play-down"></i>
    </p>
  </section>
{% endblock sidebar %}
